------------------------------------es集群-----------------------------------------
es集群节点数和副本数的关系
es不会将主分片和副本分片分配至同一个节点，同样，也不会将两个副本节点分配到同一个节点，
所以节点数和副本数的关系应该为N>=R+1 (N为节点数，R为副本数)。

es创建好索引后，就无法调整分片的设置，一个分片实际上对应一个lucene 索引，而lucene索引的读写会占用很多的系统资源，因此，分片数不能设置过大；
在创建索引时，需要合理配置分片数，一般遵循原则：
1. 控制每个分片占用的硬盘容量不超过es的最大JVM的堆空间设置(一般设置不超过32G)。
2. 节点数和分片数的关系，一般设置分片数不超过节点数的3倍，如果分片数过多，一个节点上存在多个分片，一旦节点故障，有可能会导致数据丢失，集群无法恢复。

es索引如果主分片因故障丢失，es会将一个副本分片（Replica Shard）提升为主分片,以确保数据的可用性和服务的连续性。
这个提升过程通常是由es的内置机制自动处理的，大致过程如下：
1，故障检测
es集群中的节点会不断地相互通信，以检测其他节点的状态。
如果某个节点变得不可用（如网络中断、硬件故障等），其他节点会检测到这一变化。
当某个节点上的主分片变得不可用时，集群中的其他节点会更新其内部的分片状态信息，标记该主分片为丢失。
2，副本分片提升
在检测到主分片丢失后，es会从该主分片的副本分片中选择一个作为新的主分片。
副本分片提升为主分片规则大致如下：
a，健康状态‌：es会优先选择健康状况良好的副本分片作为新的主分片。
如果某个副本分片也存在问题（如数据损坏、节点故障等），则它不会被选中。
b，节点负载‌：在选择新的主分片时，es还会考虑节点负载情况。
它会尽量选择负载较低的节点上的副本分片作为新的主分片，以避免因节点过载而影响集群性能。
c，虽然es不会直接进行“选举”来确定哪个副本分片成为新的主分片，
但它会根据上述规则选择一个最合适的副本分片进行晋升。这个过程是自动的，无需手动干预。
3，数据同步
为了确保集群状态的一致性，新的主分片会与其他副本分片进行数据同步，以确保它们包含相同的数据。
4，集群状态更新
在副本分片提升为主分片后，es会更新集群状态信息，标记新的主分片和副本分片的状态。
这确保了集群中的其他节点都能感知到这一变化，并相应地调整其行为。
-----------------------------------------------------------------------------------